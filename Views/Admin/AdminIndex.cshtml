@model List<linkHomeApp.Models.Category>
@using Microsoft.AspNetCore.Identity
@inject SignInManager<linkHomeApp.Areas.Identity.Data.User> SignInManager
@inject UserManager<linkHomeApp.Areas.Identity.Data.User> UserManager


@{
    ViewData["Title"] = "Admin";
}

<div class="container py-4">
    <h1 class="text-center mb-4">LinkHome - Admin</h1>

    @* Include the Identity login partial *@
    <partial name="_LoginPartial" />

    <div class="row">
        @foreach (var category in Model)
        {
            <div class="col-12 col-md-3 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="card-title mb-0">@category.Title</h5>
                            <div class="btn-group" role="group">
                                <a asp-action="EditCategory" asp-route-id="@category.Id"
                                    class="btn btn-sm btn-outline-secondary">Edit Category</a>
                                <a asp-action="AddLink" asp-route-categoryId="@category.Id"
                                    class="btn btn-sm btn-primary">Add Link</a>
                            </div>
                        </div>

                        <hr />

                        @{
                            var pinnedLinks = (category.Links ?? new List<linkHomeApp.Models.Link>()).Where(l =>
                            l.Pinned).OrderBy(l => l.Label).ToList();
                            var normalLinks = (category.Links ?? new List<linkHomeApp.Models.Link>()).Where(l =>
                            !l.Pinned).OrderBy(l => l.Label).ToList();
                        }

                        @if (pinnedLinks.Any())
                        {
                            <ul class="list-unstyled mb-2">
                                @foreach (var link in pinnedLinks)
                                {
                                    <li class="mb-2 d-flex justify-content-between align-items-center">
                                        <div>
                                            <img src="https://www.google.com/s2/favicons?domain_url=@link.Url" class="me-2" />
                                            <a href="@link.Url" target="_blank">@link.Label</a>
                                        </div>
                                        <div>
                                            <a asp-action="EditLink" asp-route-id="@link.Id"
                                                class="btn btn-sm btn-outline-primary me-1">Edit</a>
                                            <a asp-action="DeleteLink" asp-route-id="@link.Id"
                                                class="btn btn-sm btn-outline-danger">Delete</a>
                                        </div>
                                    </li>
                                }
                            </ul>
                            <hr />
                        }

                        @if (normalLinks.Any())
                        {
                            <ul class="list-unstyled">
                                @foreach (var link in normalLinks)
                                {
                                    <li class="mb-2 d-flex justify-content-between align-items-center">
                                        <div>
                                            <img src="https://www.google.com/s2/favicons?domain_url=@link.Url" class="me-2" />
                                            <a href="@link.Url" target="_blank">@link.Label</a>
                                        </div>
                                        <div>
                                            <a asp-action="EditLink" asp-route-id="@link.Id"
                                                class="btn btn-sm btn-outline-primary me-1">Edit</a>
                                            <a asp-action="DeleteLink" asp-route-id="@link.Id"
                                                class="btn btn-sm btn-outline-danger">Delete</a>
                                        </div>
                                    </li>
                                }
                            </ul>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>